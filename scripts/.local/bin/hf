#!/usr/bin/env sh

function finder(){
	local selection=$(find -maxdepth 1 -type d | fzf-tmux -p --multi --border=rounded \
			--preview='tree -a -C {}' --preview-window='up,1,50%,border-rounded' \
			--prompt='Directories > ' \
			--bind='del:execute(rm -ri {+})' \
			--bind='ctrl-r:toggle-preview' \
			--bind='ctrl-d:change-prompt(Directories > )' \
			--bind='ctrl-d:+reload(find -maxdepth 1 -type d)' \
			--bind='ctrl-d:+change-preview(tree -C {})' \
			--bind='ctrl-d:+refresh-preview' \
			--bind='ctrl-f:change-prompt(Files > )' \
			--bind='ctrl-f:+reload(find -maxdepth 1 -type f)' \
			--bind='ctrl-f:+change-preview(cat {})' \
			--bind='ctrl-f:+refresh-preview' \
			--bind='ctrl-p:change-prompt(Permissions > )' \
			--bind='ctrl-p:+change-preview(stat {})' \
			--bind='ctrl-p:+refresh-preview' \
			--bind='ctrl-a:select-all' \
			--bind='ctrl-x:deselect-all' \
			--header '
CTRL-D to display directories | CTRL-F to display file
CTRL-P to display permissions
CTRL-A to select all | CTRL-x to deselect all
ENTER to edit | DEL to delete
CTRL-R to toggle preview
			')
		if [ -d "$selection" ]; then
			cd "$selection" || exit
		elif [ -e "$selection" ]; then
			$EDITOR "$selection"
		fi
}

function hf(){
	if [[ -f /usr/bin/fzf ]]; then
		finder
	else
		echo "fzf not installed"
	fi
}


hf "$1"
