#!/usr/bin/env sh

function finder(){
	if git rev-parse --is-inside-work-tree > /dev/null 2>&1; then
		local selection=$(find -maxdepth 1 -type d | fzf-tmux -p --multi --border=rounded \
			--preview='tree -a -C {}' --preview-window='up,1,50%,border-rounded' \
			--prompt='Directories > ' \
			--bind='ctrl-r:toggle-preview' \
			--bind='ctrl-d:change-prompt(Directories > )' \
			--bind='ctrl-d:+reload(find -maxdepth 1 -type d)' \
			--bind='ctrl-d:+change-preview(tree -C {})' \
			--bind='ctrl-d:+refresh-preview' \
			--bind='ctrl-f:change-prompt(Files > )' \
			--bind='ctrl-f:+reload(find -maxdepth 1 -type f)' \
			--bind='ctrl-f:+change-preview(cat {})' \
			--bind='ctrl-f:+refresh-preview' \
			--bind='ctrl-g:+change-preview(git diff)' \
			--bind='ctrl-g:+refresh-preview' \
			--bind='ctrl-l:+change-preview(git status)' \
			--bind='ctrl-l:+refresh-preview' \
			--bind='ctrl-s:change-prompt(Staging > )' \
			--bind='ctrl-s:execute(git add {})' \
			--bind='ctrl-s:+change-preview(git status)' \
			--bind='ctrl-s:+refresh-preview' \
			--bind='ctrl-u:change-prompt(Unstaging > )' \
			--bind='ctrl-u:execute(git restore --staged {})' \
			--bind='ctrl-u:+change-preview(git status)'\
			--bind='ctrl-u:+refresh-preview' \
			--bind='ctrl-a:select-all' \
			--bind='ctrl-x:deselect-all' \
			--header '
CTRL-D to display directories | CTRL-F to display file
CTRL-S to stage file | CTRL-U to unstage file
CTRL-G to display diff | CTRL-L to display status
CTRL-A to select all | CTRL-x to deselect all
CTRL-R to toggle preview
			')
		else
			echo "Not in a git repository."
		fi
		if [ "$?" -ne 0 ]; then
			if [ -d "$selection" ]; then
				cd "$selection" || exit
			else
				$EDITOR "$selection"
			fi
		fi
}

function gf(){
	if [[ -f /usr/bin/fzf ]]; then
		finder
	else
		echo "fzf not installed"
	fi
}


gf "$1"
